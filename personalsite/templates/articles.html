{% extends "template.html" %}
{% block content %}

<div class="container">
  <!-- Breadcrumb -->
  <nav class="breadcrumb">
    <span class="breadcrumb-item">
      <a href="{{ url_for('home') }}">Home</a>
    </span>
    {% for crumb in breadcrumbs %}
      {% if not loop.last %}
        <span class="breadcrumb-item">
          <a href="{{ url_for('articles') }}{% for i in range(loop.index) %}{{ breadcrumbs[i] }}/{% endfor %}">
            {{ crumb }}
          </a>
        </span>
      {% else %}
        <span class="breadcrumb-item active">{{ crumb }}</span>
      {% endif %}
    {% endfor %}
  </nav>

  <!-- Two-column layout -->
  <div class="two-column">
    <!-- Main content -->
    <div class="main-column">
      {% for article in articles %}
        <article class="article-card" style="{% if article['major_type'] == 'professional' %}border-left: 3px solid var(--accent-primary);{% else %}border-left: 3px solid var(--success);{% endif %}">
          <div class="article-header">
            <h2 class="article-title">
              <a href="{{ url_for('articles') }}{{ article['url_helper'] }}">
                {{ article["title_cap"] }}
              </a>
            </h2>
            <div class="article-meta">
              <span>{{ article["date"] }}</span>
              <span>â€¢</span>
              <span style="{% if article['major_type'] == 'professional' %}color: var(--accent-primary);{% else %}color: var(--success);{% endif %}">
                {{ article["major_type"]|capitalize }}
              </span>
            </div>
          </div>

          {% if article["tags"] %}
            <div class="article-tags">
              {% for tag in article["tags"] %}
                <a href="{{ url_for('articles', tags=tag) }}" class="tag">{{ tag }}</a>
              {% endfor %}
            </div>
          {% endif %}

          <div class="article-content">
            {% if single %}
              {{ article["article"] }}
            {% else %}
              {{ article["teaser"] }}
            {% endif %}
          </div>
        </article>
      {% endfor %}

      {% if articles|length == 0 %}
        <div class="article-card">
          <p class="text-muted">No articles found matching your filters.</p>
          <a href="{{ url_for('articles', path='') }}" class="card-link">View all articles</a>
        </div>
      {% endif %}
    </div>

    <!-- Sidebar -->
    <aside class="side-column">
      <div class="sidebar">
        {% if single %}
          <!-- Related articles for single article view -->
          <h3 class="sidebar-title">Related Articles</h3>
          {% if related_articles %}
            {% for related_article in related_articles %}
              <div class="sidebar-section">
                <a href="{{ url_for('articles') }}{{ related_article['url_helper'] }}" class="card-link">
                  {{ related_article["title_cap"] }}
                </a>
              </div>
            {% endfor %}
          {% else %}
            <p class="text-muted" style="font-size: 0.875rem;">No related articles found.</p>
          {% endif %}
        {% else %}
          <!-- Filters for article list view -->
          <h3 class="sidebar-title">Filters</h3>
          
          <div class="sidebar-section">
            <h6>Area</h6>
            <div class="article-tags">
              <a href="{{ url_for('articles', path='professional') }}" class="tag">
                Professional
              </a>
              <a href="{{ url_for('articles', path='personal') }}" class="tag">
                Personal
              </a>
            </div>
          </div>

          <div class="sidebar-section">
            <h6>Year</h6>
            <div class="article-tags">
              {% for year in tag_years() %}
                <a href="{{ url_for('articles', year=year) }}" class="tag">
                  {{ year }}
                </a>
              {% endfor %}
            </div>
          </div>

          <div class="sidebar-section">
            <h6>Tags 
              <span style="font-weight: 400; font-size: 0.75rem; text-transform: none; letter-spacing: 0;">
                <a href="#" id="sort-size" onclick="sortTags('size'); return false;" style="color: var(--accent-primary);">by count</a> | 
                <a href="#" id="sort-alpha" onclick="sortTags('alpha'); return false;" style="color: var(--text-tertiary);">A-Z</a>
              </span>
            </h6>
            <div class="article-tags" id="tag-container">
              {% for tag in tags %}
                <a href="{{ url_for('articles', tags=tag[0]) }}" class="tag" data-count="{{ tag[1] }}" data-name="{{ tag[0] }}">
                  {{ tag[0] }}<span class="tag-count">{{ tag[1] }}</span>
                </a>
              {% endfor %}
            </div>
          </div>
          <script>
            function sortTags(mode) {
              const container = document.getElementById('tag-container');
              const tags = Array.from(container.children);
              tags.sort((a, b) => {
                if (mode === 'alpha') return a.dataset.name.localeCompare(b.dataset.name);
                return parseInt(b.dataset.count) - parseInt(a.dataset.count);
              });
              tags.forEach(t => container.appendChild(t));
              document.getElementById('sort-size').style.color = mode === 'size' ? 'var(--accent-primary)' : 'var(--text-tertiary)';
              document.getElementById('sort-alpha').style.color = mode === 'alpha' ? 'var(--accent-primary)' : 'var(--text-tertiary)';
            }
          </script>
        {% endif %}
      </div>
    </aside>
  </div>
</div>

{% endblock %}
